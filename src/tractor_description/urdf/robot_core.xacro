<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="mi_robot">

<!-- Desarrollo en REP 103

Base Units

Quantity	Unit
length	meter
mass	kilogram
time	second
current	ampere

Derived Units

Quantity	Unit
angle	radian
frequency	hertz
force	newton
power	watt
voltage	volt
temperature	celsius
magnetism	tesla


Chirality
Regla de la mano derecha


-->

  <xacro:include filename="colors.xacro"/> <!-- Include Colors-->
  <xacro:include filename="inertials.xacro"/> <!-- Include Inertia-->
  <xacro:property name="L" value="0.148" /><!-- WheelBase -->
  <xacro:property name="T" value="0.133" /><!-- Track -->
  <xacro:property name="r" value="0.0325" /><!-- WheelRadius -->
  <xacro:property name="w" value="0.025" /><!-- WheelWidth -->
  <xacro:property name="pi" value="3.14159"/>

  <xacro:property name="m_base" value="0.40"/>   <!-- kg -->
  <xacro:property name="m_wheel" value="0.03"/>  <!-- kg per wheel -->
  <xacro:property name="m_steer" value="0.015"/>  <!-- kg per steer -->

  <!-- LINKS DEL ROBOT-->
  <link name="base_footprint"/>

  <link name="base_link">
    <visual>
      <geometry>
        <box size="${0.85*L} ${0.6*T} ${0.5*r}"/>               
      </geometry>                
      <material name="red"/>                  
      <origin xyz="0 0 ${r}" rpy="0 0 0"/>
    </visual>
    <visual>
      <geometry>
        <box size="${0.425*L} ${0.6*T} ${0.5*r}"/>               
      </geometry>                
      <material name="red"/>                  
      <origin xyz="${-0.2125*L} 0 ${1.5*r}" rpy="0 0 0"/>
    </visual>

    <xacro:inertial_box mass="${m_base}"
                      x="${0.80*L}"
                      y="${0.50*T}"
                      z="${0.40*r}"
                      origin_xyz="0 0 ${r}"
                      origin_rpy="0 0 0"/>
                      
  </link>
 
  <link name="front_left_steer">
    <visual>
      <geometry>
         <box size="${r*.4} ${w+0.01} ${r}"/>              
      </geometry>              
      <material name="green"/>                 
    </visual>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="${m_steer}"/>
      <inertia ixx="${(m_steer/12.0)*((w+0.01)*(w+0.01) + r*r)}"
              iyy="${(m_steer/12.0)*(1.16*r*r)}"
              izz="${(m_steer/12.0)*(0.16*r*r + (w+0.01)*(w+0.01))}"
              ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="front_right_steer">
    <visual>
      <geometry>
         <box size="${r*.4} ${w+0.01} ${r}"/>                
      </geometry>                
      <material name="green"/>                 
    </visual> 
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="${m_steer}"/>
      <inertia ixx="${(m_steer/12.0)*((w+0.01)*(w+0.01) + r*r)}"
              iyy="${(m_steer/12.0)*(1.16*r*r)}"
              izz="${(m_steer/12.0)*(0.16*r*r + (w+0.01)*(w+0.01))}"
              ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="front_left_wheel">
    <visual>
      <geometry>
         <cylinder radius="${r}" length="${w}"/>               
      </geometry>                
      <material name="blue"/>  
      <origin xyz="0 0 0" rpy="${-pi/2} 0 0"/>                  
    </visual> 
    <visual>
      <geometry>
          <sphere radius="0.005"/>
      </geometry>
      <origin xyz="0 0 ${r}" rpy="0 0 0"/>
    </visual>
    <xacro:inertial_cylinder mass="${m_wheel}"
                         radius="${r}"
                         length="${w}"
                         origin_xyz="0 0 0"
                         origin_rpy="${-pi/2} 0 0"/>
  </link>

  <link name="front_right_wheel">
    <visual>
      <geometry>
         <cylinder radius="${r}" length="${w}"/>               
      </geometry>                
      <material name="blue"/>
      <origin xyz="0 0 0" rpy="${-pi/2} 0 0"/>               
    </visual>
    <visual>
      <geometry>
          <sphere radius="0.005"/>
      </geometry>
      <origin xyz="0 0 ${r}" rpy="0 0 0"/>
    </visual>
    <xacro:inertial_cylinder mass="${m_wheel}"
                         radius="${r}"
                         length="${w}"
                         origin_xyz="0 0 0"
                         origin_rpy="${-pi/2} 0 0"/>
  </link>

  <link name="back_left_wheel">
    <visual>
      <geometry>
         <cylinder radius="${r}" length="${w}"/>               
      </geometry>                
      <material name="blue"/> 
      <origin xyz="0 0 0" rpy="${-pi/2} 0 0"/>                   
    </visual>
    <visual>
      <geometry>
          <sphere radius="0.005"/>
      </geometry>
      <origin xyz="0 0 ${r}" rpy="0 0 0"/>
    </visual>
    <xacro:inertial_cylinder mass="${m_wheel}"
                         radius="${r}"
                         length="${w}"
                         origin_xyz="0 0 0"
                         origin_rpy="${-pi/2} 0 0"/>
  </link>

  <link name="back_right_wheel">
    <visual>
      <geometry>
         <cylinder radius="${r}" length="${w}"/>               
      </geometry>                
      <material name="blue"/> 
      <origin xyz="0 0 0" rpy="${-pi/2} 0 0"/>                   
    </visual> 
    <visual>
      <geometry>
          <sphere radius="0.005"/>
      </geometry>
      <origin xyz="0 0 ${r}" rpy="0 0 0"/>
    </visual>
    <xacro:inertial_cylinder mass="${m_wheel}"
                         radius="${r}"
                         length="${w}"
                         origin_xyz="0 0 0"
                         origin_rpy="${-pi/2} 0 0"/>
  </link>

  <!-- JOINTS DEL ROBOT-->

  <!-- 2) Fija base_footprint -> base_link -->
  <joint name="base_footprint_to_base_link" type="fixed">
    <parent link="base_footprint"/>
    <child link="base_link"/>
    <!-- Si tu base_link ya estÃ¡ a z=0 en el suelo, deja en 0 -->
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <joint name="joint_base_lsteer" type="revolute">
    <parent link="base_link"/>                   
    <child link="front_left_steer"/>
    <origin xyz="${0.5*L} ${0.5*T} ${r}" rpy="0 0 0"/> 
    <axis xyz="0 0 1"/>
    <limit lower="-0.6" upper="0.6" effort="1" velocity="2.0"/>
    <dynamics damping="0.1" friction="0.02"/>
  </joint>

  <joint name="joint_base_rsteer" type="revolute">
    <parent link="base_link"/>                   
    <child link="front_right_steer"/>
    <origin xyz="${0.5*L} ${-0.5*T} ${r}" rpy="0 0 0"/> 
    <axis xyz="0 0 1"/>
    <limit lower="-0.6" upper="0.6" effort="1" velocity="2.0"/>
    <dynamics damping="0.1" friction="0.02"/>
  </joint>

  <joint name="joint_steer_lfwheel" type="continuous">
    <parent link="front_left_steer"/>                   
    <child link="front_left_wheel"/>
    <origin xyz="0 0 0" rpy="0 0 0"/> 
    <axis xyz="0 1 0"/>
  </joint>

  <joint name="joint_steer_rfwheel" type="continuous">
    <parent link="front_right_steer"/>                   
    <child link="front_right_wheel"/>
    <origin xyz="0 0 0" rpy="0 0 0"/> 
    <axis xyz="0 1 0"/>
  </joint>

  <joint name="joint_base_lbwheel" type="continuous">
    <parent link="base_link"/>                   
    <child link="back_left_wheel"/>
    <origin xyz="${-0.5*L} ${0.5*T} ${r}" rpy="0 0 0"/> 
    <axis xyz="0 1 0"/>
  </joint>

  <joint name="joint_base_rbwheel" type="continuous">
    <parent link="base_link"/>                   
    <child link="back_right_wheel"/>
    <origin xyz="${-0.5*L} ${-0.5*T} ${r}" rpy="0 0 0"/> 
    <axis xyz="0 1 0"/>
  </joint>

</robot>
